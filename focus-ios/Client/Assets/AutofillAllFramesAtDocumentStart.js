(()=>{var e={291:()=>{HTMLSelectElement.isInstance=e=>e instanceof HTMLSelectElement,HTMLInputElement.isInstance=e=>e instanceof HTMLInputElement,window.Cu=class{static getWeakReference(e){const t=new WeakRef(e);return{get:()=>t.deref()}}},HTMLFormElement.prototype.addEventListener=function(){const e=this.getEventListeners("submit");console.log("submitEventListeners",e)},HTMLElement.prototype.getAutocompleteInfo=function(){return{_reason:"autocomplete",fieldName:this.getAttribute("autocomplete")in["off","on","name","honorific-prefix","given-name","additional-name","family-name","honorific-suffix","nickname","email","username","new-password","current-password","one-time-code","organization-title","organization","street-address","address-line1","address-line2","address-line3","address-level4","address-level3","address-level2","address-level1","country","country-name","postal-code","cc-name","cc-given-name","cc-additional-name","cc-family-name","cc-number","cc-exp","cc-exp-month","cc-exp-year","cc-csc","cc-type","transaction-currency","transaction-amount","language","bday","bday-day","bday-month","bday-year","sex","tel","tel-country-code","tel-national","tel-area-code","tel-local","tel-extension","impp","url","photo"]?this.getAttribute("autocomplete"):""}}}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}(()=>{"use strict";r(291);const e={FIELD_STATES:{NORMAL:"NORMAL",AUTO_FILLED:"AUTO_FILLED",PREVIEW:"PREVIEW"},FIELD_NAME_INFO:{name:"name","given-name":"name","additional-name":"name","family-name":"name",organization:"organization","street-address":"address","address-line1":"address","address-line2":"address","address-line3":"address","address-level1":"address","address-level2":"address","postal-code":"address",country:"address","country-name":"address",tel:"tel","tel-country-code":"tel","tel-national":"tel","tel-area-code":"tel","tel-local":"tel","tel-local-prefix":"tel","tel-local-suffix":"tel","tel-extension":"tel",email:"email","cc-name":"creditCard","cc-given-name":"creditCard","cc-additional-name":"creditCard","cc-family-name":"creditCard","cc-number":"creditCard","cc-exp-month":"creditCard","cc-exp-year":"creditCard","cc-exp":"creditCard","cc-type":"creditCard"},ELIGIBLE_INPUT_TYPES:["text","email","tel","number","month"],SECTION_TYPES:{ADDRESS:"address",CREDIT_CARD:"creditCard"},isAddressField(e){return!!this.FIELD_NAME_INFO[e]&&!this.isCreditCardField(e)},isCreditCardField(e){return"creditCard"==this.FIELD_NAME_INFO[e]},getCategoryFromFieldName(e){return this.FIELD_NAME_INFO[e]},getCategoriesFromFieldNames(e){let t=new Set;for(let r of e){let e=this.getCategoryFromFieldName(r);e&&t.add(e)}return Array.from(t)},isFieldVisible:e=>!e.hidden&&"none"!=e.style.display,isCreditCardOrAddressFieldType(e){if(!e)return!1;if(HTMLInputElement.isInstance(e)){if(!this.ELIGIBLE_INPUT_TYPES.includes(e.type))return!1;if(!this.isFieldVisible(e))return!1}else if(!HTMLSelectElement.isInstance(e))return!1;return!0},CC_FATHOM_NONE:0,CC_FATHOM_JS:1,CC_FATHOM_NATIVE:2,isFathomCreditCardsEnabled(e){return e!=this.CC_FATHOM_NONE},formAutofillConfidencesKeyToCCFieldType:e=>({ccNumber:"cc-number",ccName:"cc-name",ccType:"cc-type",ccExp:"cc-exp",ccExpMonth:"cc-exp-month",ccExpYear:"cc-exp-year"}[e])},t=Object.freeze(["amex","cartebancaire","diners","discover","jcb","mastercard","mir","unionpay","visa"]),n={"american express":"amex","master card":"mastercard","union pay":"unionpay"},a=[{type:"amex",start:34,end:34,len:15},{type:"amex",start:37,end:37,len:15},{type:"cartebancaire",start:4035,end:4035,len:16},{type:"cartebancaire",start:4360,end:4360,len:16},{type:"diners",start:300,end:305,len:[14,19]},{type:"diners",start:3095,end:3095,len:[14,19]},{type:"diners",start:36,end:36,len:[14,19]},{type:"diners",start:38,end:39,len:[14,19]},{type:"discover",start:6011,end:6011,len:[16,19]},{type:"discover",start:622126,end:622925,len:[16,19]},{type:"discover",start:624e3,end:626999,len:[16,19]},{type:"discover",start:628200,end:628899,len:[16,19]},{type:"discover",start:64,end:65,len:[16,19]},{type:"jcb",start:3528,end:3589,len:[16,19]},{type:"mastercard",start:2221,end:2720,len:16},{type:"mastercard",start:51,end:55,len:16},{type:"mir",start:2200,end:2204,len:16},{type:"unionpay",start:62,end:62,len:[16,19]},{type:"unionpay",start:81,end:81,len:[16,19]},{type:"visa",start:4,end:4,len:16}].sort(((e,t)=>t.start-e.start));class i{constructor({name:e,number:t,expirationString:r,expirationMonth:n,expirationYear:a,network:s,ccv:o,encryptedNumber:c}){this._name=e,this._unmodifiedNumber=t,this._encryptedNumber=c,this._ccv=o,this.number=t;let{month:l,year:d}=i.normalizeExpiration({expirationString:r,expirationMonth:n,expirationYear:a});this._expirationMonth=l,this._expirationYear=d,this.network=s}set name(e){this._name=e}set expirationMonth(e){this._expirationMonth=void 0!==e?i.normalizeExpirationMonth(e):void 0}get expirationMonth(){return this._expirationMonth}set expirationYear(e){this._expirationYear=void 0!==e?i.normalizeExpirationYear(e):void 0}get expirationYear(){return this._expirationYear}set expirationString(e){let{month:t,year:r}=i.parseExpirationString(e);this.expirationMonth=t,this.expirationYear=r}set ccv(e){this._ccv=e}get number(){return this._number}set number(e){if(e){let t=i.normalizeCardNumber(e);t=t.match(/^\d{12,}$/)?t:"",this._number=t}else this._number="";if(e&&!this.isValidNumber())throw this._number="",new Error("Invalid credit card number")}get network(){return this._network}set network(e){this._network=e||void 0}isValidNumber(){if(!this._number)return!1;let e=this._number.replace(/[\-\s]/g,""),t=e.length;if(t<12||t>19)return!1;if(!/^\d+$/.test(e))return!1;let r=0;for(let n=0;n<t;n++){let a=parseInt(e[t-n-1],10);n%2==1&&(a*=2,a>9&&(a-=9)),r+=a}return r%10==0}static normalizeCardNumber(e){return e?e.replace(/[\-\s]/g,""):null}static getType(e){for(let t=0;t<a.length;t++){const r=a[t];if("number"==typeof r.len){if(r.len!=e.length)continue}else if(e.length<r.len[0]||e.length>r.len[1])continue;const n=Math.floor(Math.log10(r.start))+1,i=parseInt(e.substring(0,n),10);if(i>=r.start&&i<=r.end)return r.type}return null}static getNetworkFromName(e){if(!e)return null;let r=e.trim().toLowerCase().normalize("NFKC");if(t.includes(r))return r;for(let e in n)if(r.includes(e))return n[e];return null}isValid(){if(!this.isValidNumber())return!1;let e=new Date,t=e.getFullYear();if(this._expirationYear>t)return!0;let r=e.getMonth()+1;return this._expirationYear==t&&this._expirationMonth>=r}get maskedNumber(){return i.getMaskedNumber(this._number)}get longMaskedNumber(){return i.getLongMaskedNumber(this._number)}static getLabelInfo({number:e,name:t,month:r,year:n,type:a}){let s=["number"];return t&&s.push("name"),r&&n&&s.push("expiration"),{id:`credit-card-label-${s.join("-")}-2`,args:{number:i.getMaskedNumber(e),name:t,month:r?.toString(),year:n?.toString(),type:a}}}static getLabel({number:e,name:t}){let r=[];return e&&r.push(i.getMaskedNumber(e)),t&&r.push(t),r.join(", ")}static normalizeExpirationMonth(e){if(e=parseInt(e,10),!(isNaN(e)||e<1||e>12))return e}static normalizeExpirationYear(e){if(e=parseInt(e,10),!(isNaN(e)||e<0))return e<100&&(e+=2e3),e}static parseExpirationString(e){let t=[{regex:/(?:^|\D)(\d{2})(\d{2})(?!\d)/},{regex:/(?:^|\D)(\d{4})[-/](\d{1,2})(?!\d)/,yearIndex:0,monthIndex:1},{regex:/(?:^|\D)(\d{1,2})[-/](\d{4})(?!\d)/,yearIndex:1,monthIndex:0},{regex:/(?:^|\D)(\d{1,2})[-/](\d{1,2})(?!\d)/},{regex:/(?:^|\D)(\d{2})(\d{2})(?!\d)/}];e=e.replaceAll(" ","");for(let r of t){let t,n,a=r.regex.exec(e);if(!a)continue;const i=[parseInt(a[1],10),parseInt(a[2],10)];if(r.yearIndex&&r.monthIndex?(t=i[r.yearIndex],n=i[r.monthIndex]):(n=i[0],n>12?(t=i[0],n=i[1]):t=i[1]),n>=1&&n<=12&&(t<100||t>2e3))return{month:n,year:t}}return{month:void 0,year:void 0}}static normalizeExpiration({expirationString:e,expirationMonth:t,expirationYear:r}){let n={};return!e||t&&r||(n=i.parseExpirationString(e)),{month:i.normalizeExpirationMonth(n.month||t),year:i.normalizeExpirationYear(n.year||r)}}static formatMaskedNumber(e){return{affix:"****",label:e.replace(/^\**/,"")}}static getCreditCardLogo(e){const t="chrome://formautofill/content/",r=t+"third-party/";switch(e){case"amex":return r+"cc-logo-amex.png";case"cartebancaire":return r+"cc-logo-cartebancaire.png";case"diners":return r+"cc-logo-diners.svg";case"discover":return r+"cc-logo-discover.png";case"jcb":return r+"cc-logo-jcb.svg";case"mastercard":return r+"cc-logo-mastercard.svg";case"mir":return r+"cc-logo-mir.svg";case"unionpay":return r+"cc-logo-unionpay.svg";case"visa":return r+"cc-logo-visa.svg";default:return t+"icon-credit-card-generic.svg"}}static getMaskedNumber(e){return"*".repeat(4)+" "+e.substr(-4)}static getLongMaskedNumber(e){return"*".repeat(e.length-4)+e.substr(-4)}static isValidNumber(e){try{new i({number:e})}catch(e){return!1}return!0}static isValidNetwork(e){return t.includes(e)}static getSupportedNetworks(){return t}static getNetworkL10nId(e){return this.isValidNetwork(e)?`autofill-card-network-${e}`:null}}const s={EXCLUDED_TAGS:["SCRIPT","NOSCRIPT","OPTION","STYLE"],_mappedLabels:null,_unmappedLabelControls:null,_labelStrings:new WeakMap,extractLabelStrings(e){if(this._labelStrings.has(e))return this._labelStrings.get(e);let t=[],r=e=>{if(!this.EXCLUDED_TAGS.includes(e.tagName))if(e.nodeType!=e.TEXT_NODE&&e.childNodes.length)for(let t of e.childNodes){let e=t.nodeType;e!=t.ELEMENT_NODE&&e!=t.TEXT_NODE||r(t)}else{let r=e.textContent.trim();r&&t.push(r)}};return r(e),this._labelStrings.set(e,t),t},generateLabelMap(e){this._mappedLabels=new Map,this._unmappedLabelControls=[],this._labelStrings=new WeakMap;for(let t of e.querySelectorAll("label")){let e,r=t.htmlFor;if(!r){if(e=t.control,!e)continue;r=e.id}if(r){let e=this._mappedLabels.get(r);e?e.push(t):this._mappedLabels.set(r,[t])}else this._unmappedLabelControls.push({label:t,control:e})}},clearLabelMap(){this._mappedLabels=null,this._unmappedLabelControls=null,this._labelStrings=null},findLabelElements(e){this._mappedLabels||this.generateLabelMap(e.ownerDocument);let t=e.id;return t?this._mappedLabels.get(t)||[]:this._unmappedLabelControls.filter((t=>t.control==e)).map((e=>e.label))}};class o extends Error{}function c(e){return e}function l(e,t,r){let n,a,i=!0;if(b((function(e){const s=t(e);(r(s,a)||i)&&(n=e,a=s,i=!1)}),e),i)throw new Error("Tried to call best() on empty iterable");return n}function d(e,t=c){return l(e,t,((e,t)=>e<t))}function h(e){let t,r=!0;return b((function(e){r?(t=e,r=!1):t+=e}),e),t}function p(e){return e.nodeType===e.TEXT_NODE&&0===e.textContent.trim().length}function m(e,t,r){if(e.has(t))return e.get(t);const n=r();return e.set(t,n),n}function u(e,t,r){return e.has(t)?e.get(t):r()}Error,new Set(["ADDRESS","BLOCKQUOTE","BODY","CENTER","DIR","DIV","DL","FIELDSET","FORM","H1","H2","H3","H4","H5","H6","HR","ISINDEX","MENU","NOFRAMES","NOSCRIPT","OL","P","PRE","TABLE","UL","DD","DT","FRAMESET","LI","TBODY","TD","TFOOT","TH","THEAD","TR","HTML"]);class f extends Set{pop(){for(let e of this.values())return this.delete(e),e;throw new Error("Tried to pop from an empty NiceSet.")}extend(e){for(let t of e)this.add(t);return this}minus(e){const t=new f(this);for(const r of e)t.delete(r);return t}toString(){return"{"+Array.from(this).join(", ")+"}"}}function y(e){for(let t of e)return t}function*x(e){for(const r of e)"string"!=typeof r&&(t=r)&&"function"==typeof t[Symbol.iterator]?yield*x(r):yield r;var t}function*g(e,t){for(const r of t)yield e(r)}function b(e,t){for(const r of t)e(r)}function E(e){return void 0!==e.nodeName}function*_(e){for(let t=e.length-1;t>=0;t--)yield e[t]}function M(e,t){let r=0,n=e,a=n&&n!==t;for(;a;)n=n.nextSibling,(a=n&&n!==t)&&!p(n)&&(r+=1);if(n!==t)for(n=t;n;)n=n.previousSibling,n&&!p(n)&&(r+=1);return r}function N(e,t,{differentDepthCost:r=2,differentTagCost:n=2,sameTagCost:a=1,strideCost:i=1,additionalCost:s=((e,t)=>0)}={}){if(e===t)return 0;const o=E(e)?e:e.element,c=E(t)?t:t.element,l=[o],d=[c];let h=o,p=c;for(;!h.contains(c);)h=h.parentNode,l.push(h);const m=o.compareDocumentPosition(c);if(m&(o.DOCUMENT_POSITION_CONTAINS|o.DOCUMENT_POSITION_CONTAINED_BY))return Number.MAX_VALUE;do{p=p.parentNode,d.push(p)}while(p!==h);let u=l,f=d,y=0;for(m&o.DOCUMENT_POSITION_FOLLOWING?(u=l,f=d):m&o.DOCUMENT_POSITION_PRECEDING&&(u=d,f=l);u.length||f.length;){const e=u.pop(),t=f.pop();y+=void 0===e||void 0===t?r:e.tagName===t.tagName?a:n,0!==i&&(y+=M(e,t)*i)}return y+s(e,t)}class F{constructor(e,t){this._matrix=new Map;const r=e.map((e=>[e]));for(let e of r){const r=new Map;for(let n of this._matrix.keys())r.set(n,t(e[0],n[0]));this._matrix.set(e,r)}this._numClusters=r.length}closest(){const e=this;if(this._numClusters<2)throw new Error("There must be at least 2 clusters in order to return the closest() ones.");return d(function(){const t=[];for(let[r,n]of e._matrix.entries())for(let[e,a]of n.entries())t.push({a:r,b:e,distance:a});return t}(),(e=>e.distance))}_cachedDistance(e,t){let r=this._matrix.get(e).get(t);return void 0===r&&(r=this._matrix.get(t).get(e)),r}merge(e,t){const r=new Map;for(let n of this._matrix.keys())n!==e&&n!==t&&r.set(n,Math.min(this._cachedDistance(e,n),this._cachedDistance(t,n)));this._matrix.delete(e),this._matrix.delete(t);for(let r of this._matrix.values())r.delete(e),r.delete(t);this._matrix.set([e,t],r),this._numClusters-=1}numClusters(){return this._numClusters}clusters(){return Array.from(this._matrix.keys()).map((e=>Array.from(x(e))))}}class w{constructor(){this._predicate=()=>!0}static fromFirstCall(e){if("type"===e.method)return new C(...e.args);if("and"===e.method)return new I(e.args);if("nearest"===e.method)return new O(e.args);throw new Error("The left-hand side of a rule() must start with dom(), type(), and(), or nearest().")}when(e){let t=this.clone();return t._predicate=e,t}fnodesSatisfyingWhen(e){return Array.from(e).filter(this._predicate)}checkFact(e){}guaranteedType(){}aggregatedType(){}}class S extends w{constructor(e){if(super(),void 0===e)throw new Error("A querySelector()-style selector is required as the argument to "+this._callName()+"().");this.selector=e}_callName(){return"dom"}clone(){return new this.constructor(this.selector)}fnodes(e){return this._domNodesToFilteredFnodes(e,e.doc.querySelectorAll(this.selector))}_domNodesToFilteredFnodes(e,t){let r=[];for(let n=0;n<t.length;n++)r.push(e.fnodeForElement(t[n]));return this.fnodesSatisfyingWhen(r)}checkFact(e){if(void 0===e.type)throw new Error(`The right-hand side of a ${this._callName()}() rule failed to specify a type. This means there is no way for its output to be used by later rules. All it specified was ${e}.`)}asLhs(){return this}possibleTypeCombinations(){return[]}typesMentioned(){return new f}}class $ extends S{_callName(){return"element"}fnodes(e){return this._domNodesToFilteredFnodes(e,e.doc.matches(this.selector)?[e.doc]:[])}}class C extends w{constructor(e){if(super(),void 0===e)throw new Error("A type name is required when calling type().");this._type=e}clone(){return new this.constructor(this._type)}fnodes(e){const t=u(e.typeCache,this._type,(()=>[]));return this.fnodesSatisfyingWhen(t)}type(e){return new this.constructor(e)}max(){return new T(this._type)}bestCluster(e){return new R(this._type,e)}guaranteedType(){return this._type}possibleTypeCombinations(){return[this.typesMentioned()]}typesMentioned(){return new f([this._type])}}class L extends C{aggregatedType(){return this._type}}class T extends L{fnodes(e){const t=this,r=()=>super.fnodes(e);return m(e.maxCache,this._type,(function(){return function(e,t=c){let r,n=[],a=!0;return b((function(e){const i=t(e);i>r||a?(n=[e],r=i,a=!1):i===r&&n.push(e)}),e),n}(r(),(r=>e.weightedScore(r.scoresSoFarFor(t._type))))}))}}class R extends L{constructor(e,t){super(e),this._options=t||{splittingDistance:3}}fnodes(e){const t=Array.from(super.fnodes(e));return 0===t.length?[]:function(e,t=c){return l(e,t,((e,t)=>e>t))}(function(e,t,r=N){const n=new F(e,r);let a;for(;n.numClusters()>1&&(a=n.closest()).distance<t;)n.merge(a.a,a.b);return n.clusters()}(t,this._options.splittingDistance,((e,t)=>N(e,t,this._options))).map((e=>[e,h(e.map((e=>e.scoreFor(this._type))))])),(e=>e[1]))[0]}}class I extends w{constructor(e){super(),this._args=e.map(v)}*fnodes(e){const t=this._args[0].fnodes(e);e:for(let e of t){for(let t of this._args.slice(1))if(!e.hasType(t.guaranteedType()))continue e;yield e}}possibleTypeCombinations(){return[this.typesMentioned()]}typesMentioned(){return new f(this._args.map((e=>e.guaranteedType())))}}function v(e){const t=e.asLhs();if(t.constructor!==C)throw new Error("and() and nearest() support only simple type() calls as arguments for now.");return t}class O extends w{constructor([e,t,r]){super(),this._a=v(e),this._b=v(t),this._distance=r}*fnodes(e){const t=this._a.fnodes(e),r=Array.from(this._b.fnodes(e));if(r.length>0)for(const e of t){const t=d(r,(t=>this._distance(e,t)));yield{fnode:e,rhsTransformer:function(e){return void 0===e.note&&(e.note=t),e}}}}checkFact(e){}possibleTypeCombinations(){return[new f([this._a.guaranteedType()])]}typesMentioned(){return new f([this._a.guaranteedType(),this._b.guaranteedType()])}guaranteedType(){return this._a.guaranteedType()}}const k={type:1,note:2,score:4,element:8};function A(e){return new Y(e)}class D{constructor(e=[],t=1/0,r){this._calls=e.slice(),this._max=t,this._types=new f(r)}atMost(e){return new this.constructor(this._calls,e,this._types)}_checkAtMost(e){if(void 0!==e.score&&e.score>this._max)throw new Error(`Score of ${e.score} exceeds the declared atMost(${this._max}).`)}props(e){function t(r){const n=e(r);for(let e in n)k.hasOwnProperty(e)&&k[e]&t.possibleSubfacts||delete n[e];return n}return t.possibleSubfacts=15,t.kind="props",new this.constructor(this._calls.concat(t),this._max,this._types)}type(e){function t(){return{type:e}}return t.possibleSubfacts=1,t.type=e,t.kind="type",new this.constructor(this._calls.concat(t),this._max,this._types)}typeIn(...e){return new this.constructor(this._calls,this._max,e)}_checkTypeIn(e,t){if(this._types.size>0)if(void 0===e.type){if(!this._types.has(t))throw new Error(`A right-hand side claimed, via typeIn(...) to emit one of the types ${this._types} but actually inherited ${t} from the left-hand side.`)}else if(!this._types.has(e.type))throw new Error(`A right-hand side claimed, via typeIn(...) to emit one of the types ${this._types} but actually emitted ${e.type}.`)}note(e){function t(t){return{note:e(t)}}return t.possibleSubfacts=2,t.kind="note",new this.constructor(this._calls.concat(t),this._max,this._types)}score(e){let t;return t="number"==typeof e?function(t){return{score:e}}:function(t){let r=e(t);return"boolean"==typeof r&&(r=Number(r)),{score:r}},t.possibleSubfacts=4,t.kind="score",new this.constructor(this._calls.concat(t),this._max,this._types)}fact(e,t){const r=new Set,n={};let a=0;for(let t of _(this._calls))if(!r.has(t.kind)&&(r.add(t.kind),~a&t.possibleSubfacts)){const r=t(e);for(let e in r)n.hasOwnProperty(e)||(n[e]=r[e]),a|=k[e]}return this._checkAtMost(n),this._checkTypeIn(n,t),n}possibleEmissions(){let e=!1;for(let t of _(this._calls)){if("props"===t.kind){e=!0;break}if("type"===t.kind)return{couldChangeType:!0,possibleTypes:new Set([t.type])}}return{couldChangeType:e,possibleTypes:this._types}}}class Y{constructor(e,t=(e=>e),r=(e=>e)){this.key=e,this.callback=t,this.allCallback=r}through(e){return new this.constructor(this.key,e,this.allCallback)}allThrough(e){return new this.constructor(this.key,this.callback,e)}asRhs(){return this}}function U(e){return new P({method:"type",args:[e]})}class P{constructor(...e){this._calls=e}max(){return this._and("max")}bestCluster(e){return this._and("bestCluster",e)}props(e){return this._and("props",e)}type(...e){return this._and("type",...e)}note(e){return this._and("note",e)}score(e){return this._and("score",e)}atMost(e){return this._and("atMost",e)}typeIn(...e){return this._and("typeIn",...e)}and(...e){return this._and("and",e)}_and(e,...t){return new this.constructor(...this._calls.concat({method:e,args:t}))}asLhs(){return this._asSide(w.fromFirstCall(this._calls[0]),this._calls.slice(1))}asRhs(){return this._asSide(new D,this._calls)}_asSide(e,t){for(let r of t)e=e[r.method](...r.args);return e}when(e){return this._and("when",e)}}class z{constructor(e,t){if(void 0===e)throw new Error("Someone tried to make a fnode without specifying the element they're talking about.");this.element=e,this._ruleset=t,this._types=new Map,this._conservedScores=new Map}hasType(e){return this._computeType(e),this._types.has(e)}scoreFor(e){return this._computeType(e),t=this._ruleset.weightedScore(this.scoresSoFarFor(e))+u(this._ruleset.biases,e,(()=>0)),1/(1+Math.exp(-t));var t}noteFor(e){return this._computeType(e),this._noteSoFarFor(e)}hasNoteFor(e){return this._computeType(e),this._hasNoteSoFarFor(e)}typesSoFar(){return this._types.keys()}_noteSoFarFor(e){return this._typeRecordForGetting(e).note}_hasNoteSoFarFor(e){return void 0!==this._noteSoFarFor(e)}scoresSoFarFor(e){return this._typeRecordForGetting(e).score}addScoreFor(e,t,r){this._typeRecordForSetting(e).score.set(r,t)}setNoteFor(e,t){if(this._hasNoteSoFarFor(e)){if(void 0!==t)throw new Error(`Someone (likely the right-hand side of a rule) tried to add a note of type ${e} to an element, but one of that type already exists. Overwriting notes is not allowed, since it would make the order of rules matter.`)}else this._typeRecordForSetting(e).note=t}_typeRecordForSetting(e){return m(this._types,e,(()=>({score:new Map})))}_typeRecordForGetting(e){return u(this._types,e,(()=>({score:new Map})))}_computeType(e){this._types.has(e)||this._ruleset.get(U(e))}}function W(e,t,r){return"string"==typeof t&&(t=A(t)),new(t instanceof Y?j:H)(e,t,r)}let B=0;class V{constructor(e,t,r){this.lhs=e.asLhs(),this.rhs=t.asRhs(),this.name=(r?r.name:void 0)||"_"+B++}prerequisites(e){function t(e,t,r,n){for(let a of t){const t=r(a);if(!(t.length>0))throw new Error(`No rule ${n} the "${a}" type, but another rule needs it as input.`);e.extend(t)}}const r=new f;return t(r,this._typesFinalized(),(t=>e.inwardRulesThatCouldEmit(t)),"emits"),t(r,this.lhs.typesMentioned(),(t=>e.inwardRulesThatCouldAdd(t)),"adds"),r}_typesFinalized(){const e=this.lhs.aggregatedType();return void 0===e?new f:new f([e])}}class H extends V{results(e){if(e.doneRules.has(this))throw new Error("A bug in Fathom caused results() to be called on an inward rule twice. That could cause redundant score contributions, etc.");const t=this,r=this.lhs.fnodes(e),n=new Set;b((function(r){const a=t.lhs.guaranteedType(),{fnode:i=r,rhsTransformer:s=c}=r,o=s(t.rhs.fact(i,a));t.lhs.checkFact(o);const l=e.fnodeForElement(o.element||i.element),d=o.type||t.lhs.guaranteedType();if(void 0!==o.score){if(void 0===d)throw new Error(`The right-hand side of a rule specified a score (${o.score}) with neither an explicit type nor one we could infer from the left-hand side.`);l.addScoreFor(d,o.score,t.name)}if(void 0!==o.type||void 0!==o.note){if(void 0===d)throw new Error(`The right-hand side of a rule specified a note (${o.note}) with neither an explicit type nor one we could infer from the left-hand side. Notes are per-type, per-node, so that's a problem.`);l.setNoteFor(d,o.note)}n.add(l)}),r),e.doneRules.add(this);for(let t of n)for(let r of t.typesSoFar())m(e.typeCache,r,(()=>new Set)).add(t);return n.values()}typesItCouldEmit(){const e=this.rhs.possibleEmissions();if(e.couldChangeType||void 0===this.lhs.guaranteedType()){if(e.possibleTypes.size>0)return e.possibleTypes;throw new Error("Could not determine the emitted type of a rule because its right-hand side calls props() without calling typeIn().")}return new Set([this.lhs.guaranteedType()])}typesItCouldAdd(){const e=new Set(this.typesItCouldEmit());return e.delete(this.lhs.guaranteedType()),e}_typesFinalized(){const e=this;return function(){const t=new f,r=e.rhs.possibleEmissions();if(r.couldChangeType)for(let n of e.lhs.possibleTypeCombinations())for(let e of r.possibleTypes)if(!n.has(e)){t.extend(n);break}return t}().extend(super._typesFinalized())}}class j extends V{results(e){return this.rhs.allCallback(g(this.rhs.callback,g((function(e){return e instanceof z?e:e.fnode}),this.lhs.fnodes(e))))}key(){return this.rhs.key}_typesFinalized(){return this.lhs.typesMentioned().extend(super._typesFinalized())}}class G{constructor(e,t=[],r=[]){this._inRules=[],this._outRules=new Map,this._rulesThatCouldEmit=new Map,this._rulesThatCouldAdd=new Map,this._coeffs=new Map(t),this.biases=new Map(r);for(let t of e)if(t instanceof H){this._inRules.push(t);const e=t.typesItCouldEmit();for(let r of e)m(this._rulesThatCouldEmit,r,(()=>[])).push(t);for(let e of t.typesItCouldAdd())m(this._rulesThatCouldAdd,e,(()=>[])).push(t)}else{if(!(t instanceof j))throw new Error(`This element of ruleset()'s first param wasn't a rule: ${t}`);this._outRules.set(t.key(),t)}}against(e){return new q(e,this._inRules,this._outRules,this._rulesThatCouldEmit,this._rulesThatCouldAdd,this._coeffs,this.biases)}rules(){return Array.from([...this._inRules,...this._outRules.values()])}}class q{constructor(e,t,r,n,a,i,s){this.doc=e,this._inRules=t,this._outRules=r,this._rulesThatCouldEmit=n,this._rulesThatCouldAdd=a,this._coeffs=i,this.biases=s,this._clearCaches(),this.elementCache=new WeakMap,this.doneRules=new Set}setCoeffsAndBiases(e,t=[]){this._coeffs=new Map(e),this.biases=new Map(t),this._clearCaches()}_clearCaches(){this.maxCache=new Map,this.typeCache=new Map}get(e){if("string"==typeof e){if(this._outRules.has(e))return Array.from(this._execute(this._outRules.get(e)));throw new Error(`There is no out() rule with key "${e}".`)}if(E(e))return this.fnodeForElement(e);if(void 0!==e.asLhs){const t=W(e,A(Symbol("outKey")));return Array.from(this._execute(t))}throw new Error("ruleset.get() expects a string, an expression like on the left-hand side of a rule, or a DOM node.")}weightedScore(e){let t=0;for(const[r,n]of e)t+=n*u(this._coeffs,r,(()=>1));return t}_prerequisitesTo(e,t=new Map){for(let r of e.prerequisites(this))if(!this.doneRules.has(r)){const n=t.has(r);m(t,r,(()=>[])).push(e),n||this._prerequisitesTo(r,t)}return t}_execute(e){const t=this._prerequisitesTo(e);let r,n;try{r=[e].concat(function(e,t){const r=[],n=new Set(e),a=new Set;function i(e){if(a.has(e))throw new o("The graph has a cycle.");if(n.has(e)){a.add(e);for(let r of t(e))i(r);a.delete(e),n.delete(e),r.push(e)}}for(;n.size>0;)i(y(n));return r}(t.keys(),(e=>t.get(e))))}catch(e){throw e instanceof o?new o("There is a cyclic dependency in the ruleset."):e}for(let e of _(r))n=e.results(this);return Array.from(n)}inwardRulesThatCouldEmit(e){return u(this._rulesThatCouldEmit,e,(()=>[]))}inwardRulesThatCouldAdd(e){return u(this._rulesThatCouldAdd,e,(()=>[]))}fnodeForElement(e){return m(this.elementCache,e,(()=>new z(e,this)))}}function K(e){return function(e){return new $(e)}(e)}var X={RULES:{"cc-name":void 0,"cc-number":void 0,"cc-exp-month":void 0,"cc-exp-year":void 0,"cc-exp":void 0,"cc-type":void 0},RULE_SETS:[{"cc-name":"account.*holder.*name|^(kredit)?(karten|konto)inhaber|^(name).*karte|nom.*(titulaire|détenteur)|(titulaire|détenteur).*(carte)|cc-?name|card-?name|cardholder-?name|(^nom$)|card.?(?:holder|owner)|name.*(\\b)?on(\\b)?.*card|(?:card|cc).?name|cc.?full.?name|(?:card|cc).?owner|nombre.*tarjeta|nom.*carte|nome.*cart|名前|Имя.*карты|信用卡开户名|开户名|持卡人姓名|持卡人姓名","cc-number":"(cc|kk)nr|(kredit)?(karten)(nummer|nr)|(numero|número|numéro).*(carte)|cc-?number|cc-?num|card-?number|card-?num|cc-?no|card-?no|numero-?carte|num-?carte|cb-?num|(add)?(?:card|cc|acct).?(?:number|#|no|num)|カード番号|Номер.*карты|信用卡号|信用卡号码|信用卡卡號|카드","cc-exp":"mm\\s*(/|\\|-)\\s*(yy|jj|aa)|(month|mois)\\s*(/|\\|-|et)\\s*(year|année)|(^cc-?exp$)|(^card-?exp$)|(^cc-?expiration$)|(^card-?expiration$)|(^cc-?ex$)|(^card-?ex$)|(^card-?expire$)|(^card-?expiry$)|(^validite$)|(^expiration$)|(^expiry$)|mm-?yy|mm-?yyyy|yy-?mm|yyyy-?mm|expiration-?date|payment-?card-?expiration|(^payment-?cc-?date$)|expir|exp.*date|^expfield$|ablaufdatum|gueltig|gültig|fecha|date.*exp|scadenza|有効期限|validade|Срок действия карты","cc-exp-month":"(cc|kk)month|(^exp-?month$)|(^cc-?exp-?month$)|(^cc-?month$)|(^card-?month$)|(^cc-?mo$)|(^card-?mo$)|(^exp-?mo$)|(^card-?exp-?mo$)|(^cc-?exp-?mo$)|(^card-?expiration-?month$)|(^expiration-?month$)|(^cc-?mm$)|(^cc-?m$)|(^card-?mm$)|(^card-?m$)|(^card-?exp-?mm$)|(^cc-?exp-?mm$)|(^exp-?mm$)|(^exp-?m$)|(^expire-?month$)|(^expire-?mo$)|(^expiry-?month$)|(^expiry-?mo$)|(^card-?expire-?month$)|(^card-?expire-?mo$)|(^card-?expiry-?month$)|(^card-?expiry-?mo$)|(^mois-?validite$)|(^mois-?expiration$)|(^m-?validite$)|(^m-?expiration$)|(^expiry-?date-?field-?month$)|(^expiration-?date-?month$)|(^expiration-?date-?mm$)|(^exp-?mon$)|(^validity-?mo$)|(^exp-?date-?mo$)|(^cb-?date-?mois$)|(^date-?m$)|exp.*mo|ccmonth|cardmonth|addmonth|monat|月","cc-exp-year":"(cc|kk)year|(^exp-?year$)|(^cc-?exp-?year$)|(^cc-?year$)|(^card-?year$)|(^cc-?yr$)|(^card-?yr$)|(^exp-?yr$)|(^card-?exp-?yr$)|(^cc-?exp-?yr$)|(^card-?expiration-?year$)|(^expiration-?year$)|(^cc-?yy$)|(^cc-?y$)|(^card-?yy$)|(^card-?y$)|(^card-?exp-?yy$)|(^cc-?exp-?yy$)|(^exp-?yy$)|(^exp-?y$)|(^cc-?yyyy$)|(^card-?yyyy$)|(^card-?exp-?yyyy$)|(^cc-?exp-?yyyy$)|(^expire-?year$)|(^expire-?yr$)|(^expiry-?year$)|(^expiry-?yr$)|(^card-?expire-?year$)|(^card-?expire-?yr$)|(^card-?expiry-?year$)|(^card-?expiry-?yr$)|(^an-?validite$)|(^an-?expiration$)|(^annee-?validite$)|(^annee-?expiration$)|(^expiry-?date-?field-?year$)|(^expiration-?date-?year$)|(^cb-?date-?ann$)|(^expiration-?date-?yy$)|(^expiration-?date-?yyyy$)|(^validity-?year$)|(^exp-?date-?year$)|(^date-?y$)|(add)?year|jahr|年|有效期","cc-type":"type|Kartenmarke|(^cc-?type$)|(^card-?type$)|(^card-?brand$)|(^cc-?brand$)|(^cb-?type$)"}],_getRule(e){let t=[];this.RULE_SETS.forEach((r=>{r[e]&&t.push(`(${r[e]})`.normalize("NFKC"))}));const r=new RegExp(t.join("|"),"iu");return Object.defineProperty(this.RULES,e,{get:void 0}),Object.defineProperty(this.RULES,e,{value:r}),r},init(){Object.keys(this.RULES).forEach((e=>Object.defineProperty(this.RULES,e,{get:()=>X._getRule(e)})))}};X.init();const J=/^mm$|\(mm\)/i,Q=/^(yy|yyyy)$|\(yy\)|\(yyyy\)/i,Z=/month/i,ee=/year/i,te=/mm\s*(\/|\\)\s*yy/i,re=/visa(-|\s)checkout/i,ne=new RegExp(i.getSupportedNetworks().concat(Object.keys(n)).join("|"),"gui"),ae=/(?:exp.*date[^y\\n\\r]*|mm\\s*[-/]?\\s*)yy(?:[^y]|$)/i,ie=/(?:exp.*date[^y\\n\\r]*|mm\\s*[-/]?\\s*)yyyy(?:[^y]|$)/i,se=/^dwfrm/i,oe=/bml/i,ce=/^\{\{.*\}\}$/,le=/first/i,de=/last/i,he=/gift/i,pe=/subscription/i;function me(e,t){return getAutocompleteInfo(e).fieldName===t}function ue(t){const r={elements:[t]};return Array.from(r.elements).filter((t=>e.isCreditCardOrAddressFieldType(t)))}function fe(e,t){const r=function(e){const t=ue(e),r=t.indexOf(e);return t[r+1]}(e);return!!r&&t(r)}function ye(e,t){const r=function(e){const t=ue(e),r=t.indexOf(e);return t[r-1]}(e);return!!r&&t(r)}function xe(e){return fe(e.element,(e=>me(e,"cc-exp-year")))}function ge(e){return ye(e.element,(e=>me(e,"cc-exp-month")))}function be(e,t){for(const r of[e.id,e.name])if(t.test(r))return!0;return!1}function Ee(e){return{*[Symbol.iterator](){const t=s.findLabelElements(e);for(let e of t)yield*s.extractLabelStrings(e)}}}function _e(e,t){const r=Ee(e);for(const e of r)if(t.test(e))return!0;const n=e.parentElement;return!!n&&("TD"===n.tagName&&n.parentElement?t.test(n.parentElement.textContent):!("DD"!==n.tagName||!n.previousElementSibling)&&t.test(n.previousElementSibling.textContent))}function Me(e,t){const r=e.previousElementSibling;if(null!==r&&"LABEL"===r.tagName)return t.test(r.textContent);const n=e.nextElementSibling;return null!==n&&"LABEL"===n.tagName&&t.test(n.textContent)}function Ne(e,t){const r=e.getAttribute("aria-label");return!!r&&t.test(r)}function Fe(e,t){const r=e.getAttribute("placeholder");return!!r&&t.test(r)}function we(e,t){return fe(e,(e=>be(e,t)))}function Se(e,t){return fe(e,(e=>_e(e,t)))}function $e(e,t){return fe(e,(e=>Fe(e,t)))}function Ce(e,t){return fe(e,(e=>Ne(e,t)))}function Le(e,t){return ye(e,(e=>be(e,t)))}function Te(e,t){return ye(e,(e=>_e(e,t)))}function Re(e,t){return ye(e,(e=>Fe(e,t)))}function Ie(e,t){return ye(e,(e=>Ne(e,t)))}function ve(e){const t=e.element;if("SELECT"===t.tagName)for(let e of t.querySelectorAll("option"))if(i.getNetworkFromName(e.value)||i.getNetworkFromName(e.text))return!0;return!1}function Oe(e){const t=e.element,r=t.type;if(r&&"radio"===r){const e=t.value.match(ne);if(e)return 1===e.length;const r=Ee(t);let n=0;for(const e of r){const t=e.match(ne);if(t){if(t.length>1)return!1;n++}}if(n>0)return 1===n;const a=t.textContent.match(ne);if(a)return 1===a.length}return!1}function ke(e,t){return e.some(((r,n)=>t.every(((t,r)=>t===e[n+r]))))}function Ae(e){if("SELECT"!==e.tagName)return!1;const t=[...e.options],r=Array(12).fill(1).map(((e,t)=>e+t));return!(t.length<12||t.length>13)&&(ke(t.map((e=>+e.value)),r)||ke(t.map((e=>+e.label)),r))}function De(e){if("SELECT"!==e.tagName)return!1;const t=[...e.options],r=(new Date).getFullYear(),n=Array(3).fill(0).map(((e,t)=>e+r+t));return ke(t.map((e=>+e.value)),n)||ke(t.map((e=>+e.label)),n)}function Ye(e){return fe(e.element,De)}function Ue(e){return ye(e.element,Ae)}function Pe(e,t){const r=e.element;return t(r,ae)||t(r,ie)}function ze(e,t){return e.element.maxLength===t}function We(e){const t=e.element.getAttribute("role");return!!t&&"menu"===t}function Be(e){return be(e.element,se)&&be(e.element,oe)}function Ve(e){const t=e.element.getAttribute("value");return!!t&&ce.test(t)}function He(e){const t=e.element.type;return!!t&&!["text","tel","number"].includes(t)}function je(e){return be(e.element,le)&&be(e.element,de)}function*Ge(e,t){for(const[n,a]of Object.entries(t))yield W(U(e),(r=a,new P({method:"score",args:[r]})),{name:n});var r}function qe(e,t){return function(e,t=[],r=[]){return new G(e,t,r)}([W(K("input:not([type]), input[type=text], input[type=textbox], input[type=email], input[type=tel], input[type=number], input[type=month], select, button"),U("typicalCandidates")),W(U("typicalCandidates"),U("cc-number")),...Ge("cc-number",{idOrNameMatchNumberRegExp:e=>be(e.element,X.RULES["cc-number"]),labelsMatchNumberRegExp:e=>_e(e.element,X.RULES["cc-number"]),closestLabelMatchesNumberRegExp:e=>Me(e.element,X.RULES["cc-number"]),placeholderMatchesNumberRegExp:e=>Fe(e.element,X.RULES["cc-number"]),ariaLabelMatchesNumberRegExp:e=>Ne(e.element,X.RULES["cc-number"]),idOrNameMatchGift:e=>be(e.element,he),labelsMatchGift:e=>_e(e.element,he),placeholderMatchesGift:e=>Fe(e.element,he),ariaLabelMatchesGift:e=>Ne(e.element,he),idOrNameMatchSubscription:e=>be(e.element,pe),idOrNameMatchDwfrmAndBml:Be,hasTemplatedValue:Ve,inputTypeNotNumbery:He}),W(U("cc-number"),A("cc-number")),W(U("typicalCandidates"),U("cc-name")),...Ge("cc-name",{idOrNameMatchNameRegExp:e=>be(e.element,X.RULES["cc-name"]),labelsMatchNameRegExp:e=>_e(e.element,X.RULES["cc-name"]),closestLabelMatchesNameRegExp:e=>Me(e.element,X.RULES["cc-name"]),placeholderMatchesNameRegExp:e=>Fe(e.element,X.RULES["cc-name"]),ariaLabelMatchesNameRegExp:e=>Ne(e.element,X.RULES["cc-name"]),idOrNameMatchFirst:e=>be(e.element,le),labelsMatchFirst:e=>_e(e.element,le),placeholderMatchesFirst:e=>Fe(e.element,le),ariaLabelMatchesFirst:e=>Ne(e.element,le),idOrNameMatchLast:e=>be(e.element,de),labelsMatchLast:e=>_e(e.element,de),placeholderMatchesLast:e=>Fe(e.element,de),ariaLabelMatchesLast:e=>Ne(e.element,de),idOrNameMatchSubscription:e=>be(e.element,pe),idOrNameMatchFirstAndLast:je,idOrNameMatchDwfrmAndBml:Be,hasTemplatedValue:Ve}),W(U("cc-name"),A("cc-name")),W(K("input:not([type]), input[type=text], input[type=textbox], input[type=email], input[type=tel], input[type=number], input[type=radio], select, button"),U("cc-type")),...Ge("cc-type",{idOrNameMatchTypeRegExp:e=>be(e.element,X.RULES["cc-type"]),labelsMatchTypeRegExp:e=>_e(e.element,X.RULES["cc-type"]),closestLabelMatchesTypeRegExp:e=>Me(e.element,X.RULES["cc-type"]),idOrNameMatchVisaCheckout:e=>be(e.element,re),ariaLabelMatchesVisaCheckout:e=>Ne(e.element,re),isSelectWithCreditCardOptions:ve,isRadioWithCreditCardText:Oe,idOrNameMatchSubscription:e=>be(e.element,pe),idOrNameMatchDwfrmAndBml:Be,hasTemplatedValue:Ve}),W(U("cc-type"),A("cc-type")),W(U("typicalCandidates"),U("cc-exp")),...Ge("cc-exp",{labelsMatchExpRegExp:e=>_e(e.element,X.RULES["cc-exp"]),closestLabelMatchesExpRegExp:e=>Me(e.element,X.RULES["cc-exp"]),placeholderMatchesExpRegExp:e=>Fe(e.element,X.RULES["cc-exp"]),labelsMatchExpWith2Or4DigitYear:e=>Pe(e,_e),placeholderMatchesExpWith2Or4DigitYear:e=>Pe(e,Fe),labelsMatchMMYY:e=>_e(e.element,te),placeholderMatchesMMYY:e=>Fe(e.element,te),maxLengthIs7:e=>ze(e,7),idOrNameMatchSubscription:e=>be(e.element,pe),idOrNameMatchDwfrmAndBml:Be,hasTemplatedValue:Ve,isExpirationMonthLikely:e=>Ae(e.element),isExpirationYearLikely:e=>De(e.element),idOrNameMatchMonth:e=>be(e.element,Z),idOrNameMatchYear:e=>be(e.element,ee),idOrNameMatchExpMonthRegExp:e=>be(e.element,X.RULES["cc-exp-month"]),idOrNameMatchExpYearRegExp:e=>be(e.element,X.RULES["cc-exp-year"]),idOrNameMatchValidation:e=>be(e.element,/validate|validation/i)}),W(U("cc-exp"),A("cc-exp")),W(U("typicalCandidates"),U("cc-exp-month")),...Ge("cc-exp-month",{idOrNameMatchExpMonthRegExp:e=>be(e.element,X.RULES["cc-exp-month"]),labelsMatchExpMonthRegExp:e=>_e(e.element,X.RULES["cc-exp-month"]),closestLabelMatchesExpMonthRegExp:e=>Me(e.element,X.RULES["cc-exp-month"]),placeholderMatchesExpMonthRegExp:e=>Fe(e.element,X.RULES["cc-exp-month"]),ariaLabelMatchesExpMonthRegExp:e=>Ne(e.element,X.RULES["cc-exp-month"]),idOrNameMatchMonth:e=>be(e.element,Z),labelsMatchMonth:e=>_e(e.element,Z),placeholderMatchesMonth:e=>Fe(e.element,Z),ariaLabelMatchesMonth:e=>Ne(e.element,Z),nextFieldIdOrNameMatchExpYearRegExp:e=>we(e.element,X.RULES["cc-exp-year"]),nextFieldLabelsMatchExpYearRegExp:e=>Se(e.element,X.RULES["cc-exp-year"]),nextFieldPlaceholderMatchExpYearRegExp:e=>$e(e.element,X.RULES["cc-exp-year"]),nextFieldAriaLabelMatchExpYearRegExp:e=>Ce(e.element,X.RULES["cc-exp-year"]),nextFieldIdOrNameMatchYear:e=>we(e.element,ee),nextFieldLabelsMatchYear:e=>Se(e.element,ee),nextFieldPlaceholderMatchesYear:e=>$e(e.element,ee),nextFieldAriaLabelMatchesYear:e=>Ce(e.element,ee),nextFieldMatchesExpYearAutocomplete:xe,isExpirationMonthLikely:e=>Ae(e.element),nextFieldIsExpirationYearLikely:Ye,maxLengthIs2:e=>ze(e,2),placeholderMatchesMM:e=>Fe(e.element,J),roleIsMenu:We,idOrNameMatchSubscription:e=>be(e.element,pe),idOrNameMatchDwfrmAndBml:Be,hasTemplatedValue:Ve}),W(U("cc-exp-month"),A("cc-exp-month")),W(U("typicalCandidates"),U("cc-exp-year")),...Ge("cc-exp-year",{idOrNameMatchExpYearRegExp:e=>be(e.element,X.RULES["cc-exp-year"]),labelsMatchExpYearRegExp:e=>_e(e.element,X.RULES["cc-exp-year"]),closestLabelMatchesExpYearRegExp:e=>Me(e.element,X.RULES["cc-exp-year"]),placeholderMatchesExpYearRegExp:e=>Fe(e.element,X.RULES["cc-exp-year"]),ariaLabelMatchesExpYearRegExp:e=>Ne(e.element,X.RULES["cc-exp-year"]),idOrNameMatchYear:e=>be(e.element,ee),labelsMatchYear:e=>_e(e.element,ee),placeholderMatchesYear:e=>Fe(e.element,ee),ariaLabelMatchesYear:e=>Ne(e.element,ee),previousFieldIdOrNameMatchExpMonthRegExp:e=>Le(e.element,X.RULES["cc-exp-month"]),previousFieldLabelsMatchExpMonthRegExp:e=>Te(e.element,X.RULES["cc-exp-month"]),previousFieldPlaceholderMatchExpMonthRegExp:e=>Re(e.element,X.RULES["cc-exp-month"]),previousFieldAriaLabelMatchExpMonthRegExp:e=>Ie(e.element,X.RULES["cc-exp-month"]),previousFieldIdOrNameMatchMonth:e=>Le(e.element,Z),previousFieldLabelsMatchMonth:e=>Te(e.element,Z),previousFieldPlaceholderMatchesMonth:e=>Re(e.element,Z),previousFieldAriaLabelMatchesMonth:e=>Ie(e.element,Z),previousFieldMatchesExpMonthAutocomplete:ge,isExpirationYearLikely:e=>De(e.element),previousFieldIsExpirationMonthLikely:Ue,placeholderMatchesYYOrYYYY:e=>Fe(e.element,Q),roleIsMenu:We,idOrNameMatchSubscription:e=>be(e.element,pe),idOrNameMatchDwfrmAndBml:Be,hasTemplatedValue:Ve}),W(U("cc-exp-year"),A("cc-exp-year"))],e,t)}const Ke={"cc-number":[["idOrNameMatchNumberRegExp",7.679469585418701],["labelsMatchNumberRegExp",5.122580051422119],["closestLabelMatchesNumberRegExp",2.1256935596466064],["placeholderMatchesNumberRegExp",9.471800804138184],["ariaLabelMatchesNumberRegExp",6.067715644836426],["idOrNameMatchGift",-22.946273803710938],["labelsMatchGift",-7.852959632873535],["placeholderMatchesGift",-2.355496406555176],["ariaLabelMatchesGift",-2.940307855606079],["idOrNameMatchSubscription",.11255314946174622],["idOrNameMatchDwfrmAndBml",-.0006645023822784424],["hasTemplatedValue",-.11370040476322174],["inputTypeNotNumbery",-3.750155210494995]],"cc-name":[["idOrNameMatchNameRegExp",7.496212959289551],["labelsMatchNameRegExp",6.081472873687744],["closestLabelMatchesNameRegExp",2.600574254989624],["placeholderMatchesNameRegExp",5.750874042510986],["ariaLabelMatchesNameRegExp",5.162227153778076],["idOrNameMatchFirst",-6.742659091949463],["labelsMatchFirst",-.5234538912773132],["placeholderMatchesFirst",-3.4615235328674316],["ariaLabelMatchesFirst",-1.3145145177841187],["idOrNameMatchLast",-12.561869621276855],["labelsMatchLast",-.27417105436325073],["placeholderMatchesLast",-1.434966802597046],["ariaLabelMatchesLast",-2.9319725036621094],["idOrNameMatchFirstAndLast",24.123435974121094],["idOrNameMatchSubscription",.08349418640136719],["idOrNameMatchDwfrmAndBml",.01882520318031311],["hasTemplatedValue",.182317852973938]],"cc-type":[["idOrNameMatchTypeRegExp",2.0581533908843994],["labelsMatchTypeRegExp",1.0784518718719482],["closestLabelMatchesTypeRegExp",.6995877623558044],["idOrNameMatchVisaCheckout",-3.320356845855713],["ariaLabelMatchesVisaCheckout",-3.4196767807006836],["isSelectWithCreditCardOptions",10.337477684020996],["isRadioWithCreditCardText",4.530318737030029],["idOrNameMatchSubscription",-3.7206356525421143],["idOrNameMatchDwfrmAndBml",-.08782318234443665],["hasTemplatedValue",.1772511601448059]],"cc-exp":[["labelsMatchExpRegExp",7.588159561157227],["closestLabelMatchesExpRegExp",1.41484534740448],["placeholderMatchesExpRegExp",8.759064674377441],["labelsMatchExpWith2Or4DigitYear",-3.876218795776367],["placeholderMatchesExpWith2Or4DigitYear",2.8364884853363037],["labelsMatchMMYY",8.836017608642578],["placeholderMatchesMMYY",-.5231751799583435],["maxLengthIs7",1.3565447330474854],["idOrNameMatchSubscription",.1779913753271103],["idOrNameMatchDwfrmAndBml",.21037884056568146],["hasTemplatedValue",.14900512993335724],["isExpirationMonthLikely",-3.223409652709961],["isExpirationYearLikely",-2.536919593811035],["idOrNameMatchMonth",-3.6893014907836914],["idOrNameMatchYear",-3.108184337615967],["idOrNameMatchExpMonthRegExp",-2.264357089996338],["idOrNameMatchExpYearRegExp",-2.7957723140716553],["idOrNameMatchValidation",-2.29402756690979]],"cc-exp-month":[["idOrNameMatchExpMonthRegExp",.2787344455718994],["labelsMatchExpMonthRegExp",1.298413634300232],["closestLabelMatchesExpMonthRegExp",-11.206244468688965],["placeholderMatchesExpMonthRegExp",1.2605619430541992],["ariaLabelMatchesExpMonthRegExp",1.1330018043518066],["idOrNameMatchMonth",6.1464314460754395],["labelsMatchMonth",.7051732540130615],["placeholderMatchesMonth",.7463492751121521],["ariaLabelMatchesMonth",1.8244760036468506],["nextFieldIdOrNameMatchExpYearRegExp",.06347066164016724],["nextFieldLabelsMatchExpYearRegExp",-.1692247837781906],["nextFieldPlaceholderMatchExpYearRegExp",1.0434566736221313],["nextFieldAriaLabelMatchExpYearRegExp",1.751156210899353],["nextFieldIdOrNameMatchYear",-.532447338104248],["nextFieldLabelsMatchYear",1.3248541355133057],["nextFieldPlaceholderMatchesYear",.604235827922821],["nextFieldAriaLabelMatchesYear",1.5364223718643188],["nextFieldMatchesExpYearAutocomplete",6.285938262939453],["isExpirationMonthLikely",13.117807388305664],["nextFieldIsExpirationYearLikely",7.182341575622559],["maxLengthIs2",4.477289199829102],["placeholderMatchesMM",14.403288841247559],["roleIsMenu",5.770959854125977],["idOrNameMatchSubscription",-.043085768818855286],["idOrNameMatchDwfrmAndBml",.02823038399219513],["hasTemplatedValue",.07234494388103485]],"cc-exp-year":[["idOrNameMatchExpYearRegExp",5.426016807556152],["labelsMatchExpYearRegExp",1.3240209817886353],["closestLabelMatchesExpYearRegExp",-8.702284812927246],["placeholderMatchesExpYearRegExp",.9059725999832153],["ariaLabelMatchesExpYearRegExp",.5550334453582764],["idOrNameMatchYear",5.362994194030762],["labelsMatchYear",2.7185044288635254],["placeholderMatchesYear",.7883157134056091],["ariaLabelMatchesYear",.311492383480072],["previousFieldIdOrNameMatchExpMonthRegExp",1.8155208826065063],["previousFieldLabelsMatchExpMonthRegExp",-.46133187413215637],["previousFieldPlaceholderMatchExpMonthRegExp",1.0374903678894043],["previousFieldAriaLabelMatchExpMonthRegExp",-.5901495814323425],["previousFieldIdOrNameMatchMonth",-5.960310935974121],["previousFieldLabelsMatchMonth",.6495584845542908],["previousFieldPlaceholderMatchesMonth",.7198042273521423],["previousFieldAriaLabelMatchesMonth",3.4590985774993896],["previousFieldMatchesExpMonthAutocomplete",2.986003875732422],["isExpirationYearLikely",4.021566390991211],["previousFieldIsExpirationMonthLikely",9.298635482788086],["placeholderMatchesYYOrYYYY",10.457176208496094],["roleIsMenu",1.1051956415176392],["idOrNameMatchSubscription",.000688597559928894],["idOrNameMatchDwfrmAndBml",.15687309205532074],["hasTemplatedValue",-.19141331315040588]]},Xe=[["cc-number",-4.948795795440674],["cc-name",-5.3578081130981445],["cc-type",-5.979659557342529],["cc-exp",-5.849575996398926],["cc-exp-month",-8.844199180603027],["cc-exp-year",-6.499860763549805]],Je={"cc-number":qe([...Ke["cc-number"]],Xe),"cc-name":qe([...Ke["cc-name"]],Xe),supportedTypes:["cc-number","cc-name"],types:["cc-number","cc-name"]},Qe=()=>{},Ze="-moz-section-default",et=["address-level3","address-level2","address-level1","tel","postal-code","email","street-address"],tt={"cc-number":4};class rt{constructor(e,{allowDuplicates:t=!1,sectionEnabled:r=!0}){this._elementsWeakRef=Cu.getWeakReference(e),this.fieldDetails=[],this._parsingIndex=0,this._sections=[],this._allowDuplicates=t,this._sectionEnabled=r}get _elements(){return this._elementsWeakRef.get()}get parsingIndex(){return this._parsingIndex}set parsingIndex(e){if(e>this._elements.length)throw new Error("The parsing index is out of range.");this._parsingIndex=e}getFieldDetailByIndex(e){if(e>=this._elements.length)throw new Error(`The index ${e} is out of range.(${this._elements.length})`);if(e<this.fieldDetails.length)return this.fieldDetails[e];for(let t=this.fieldDetails.length;t<e+1;t++)this.pushDetail();return this.fieldDetails[e]}get parsingFinished(){return this.parsingIndex>=this._elements.length}_pushToSection(e,t){for(let r of this._sections)if(r.name==e)return void r.fieldDetails.push(t);this._sections.push({name:e,fieldDetails:[t]})}_mergeNextNFields(e,t,r,n,a){if(e)e--;else{let i=tt[t]-2,s=r.slice(n+1,n+1+i);s.length==i&&s.every((e=>e.fieldName==t))?e=i:a=!0}return{mergeNextNFields:e,createNewSection:a}}_classifySections(){let e=this._sections[0].fieldDetails;this._sections=[];let t,r=new Set,n=0,a=0;for(let i=0;i<e.length;i++){let s=e[i].fieldName;if(!s)continue;let o=!1;r.has(s)&&(t!=s?o=!0:et.includes(s)||(s in tt?({mergeNextNFields:a,createNewSection:o}=this._mergeNextNFields(a,s,e,i,o)):o=!0)),o&&(a=0,r.clear(),n++),t=s,r.add(s),this._pushToSection("-moz-section-default-"+n,e[i])}}getSectionFieldDetails(){return this._sectionEnabled?this._sections.length?(1==this._sections.length&&this._sections[0].name==Ze&&this._classifySections(),this._sections.reduce(((e,t)=>(e.push(...this._getFinalDetails(t.fieldDetails)),e)),[])):[]:this._getFinalDetails(this.fieldDetails)}pushDetail(){let e=this.fieldDetails.length;if(e>=this._elements.length)throw new Error("Try to push the non-existing element info.");let t=this._elements[e],r=nt.getInfo(t,this),n={section:r?.section??"",addressType:r?.addressType??"",contactType:r?.contactType??"",fieldName:r?.fieldName??"",confidence:r?.confidence,elementWeakRef:Cu.getWeakReference(t)};r?._reason&&(n._reason=r._reason),this.fieldDetails.push(n),this._pushToSection(this._getSectionName(n),n)}_getSectionName(e){let t=[];return e.section&&t.push(e.section),e.addressType&&t.push(e.addressType),t.length?t.join(" "):Ze}updateFieldName(e,t){if(e>=this.fieldDetails.length)throw new Error("Try to update the non-existing field detail.");this.fieldDetails[e].fieldName=t}_isSameField(e,t){return e.section==t.section&&e.addressType==t.addressType&&e.fieldName==t.fieldName&&!e.transform&&!t.transform}_transformCCNumberForMultipleFields(e){let t=e.filter((e=>"cc-number"==e.fieldName&&4==e.elementWeakRef.get().maxLength));4==t.length&&(t[0].transform=e=>e.slice(0,4),t[1].transform=e=>e.slice(4,8),t[2].transform=e=>e.slice(8,12),t[3].transform=e=>e.slice(12,16))}_getFinalDetails(t){let r=[],n=[];for(let a of t){let t=a.fieldName;e.isAddressField(t)?r.push(a):e.isCreditCardField(t)?n.push(a):Qe("Not collecting a field with a unknown fieldName",a)}return this._transformCCNumberForMultipleFields(n),[{type:e.SECTION_TYPES.ADDRESS,fieldDetails:r},{type:e.SECTION_TYPES.CREDIT_CARD,fieldDetails:n}].map((e=>{if(this._allowDuplicates)return e;let t=e.fieldDetails;return e.fieldDetails=t.filter(((e,r)=>!t.slice(0,r).find((t=>this._isSameField(e,t))))),e})).filter((e=>!!e.fieldDetails.length))}elementExisting(e){return e<this._elements.length}getFathomField(e,t){if(!t.length)return[null,null];if(!this._fathomConfidences?.get(e)){this._fathomConfidences=new Map;let t=[];t=this._elements?.includes(e)?this._elements:[e];let r=rt.getFormAutofillConfidences(t);for(let e=0;e<t.length;e++)this._fathomConfidences.set(t[e],r[e])}let r=this._fathomConfidences.get(e);if(!r)return[null,null];let n=null,a=.5;for(let[e,i]of Object.entries(r))t.includes(e)&&i>a&&(a=i,n=e);return n?[n,a]:[null,null]}static getFormAutofillConfidences(t){return 1==e.CC_FATHOM_NATIVE?ChromeUtils.getFormAutofillConfidences(t).map((t=>{let r={};for(let[n,a]of Object.entries(t))r[e.formAutofillConfidencesKeyToCCFieldType(n)]=a;return r})):t.map((e=>{let t={};return Je.types.map((r=>{t[r]=function(t){const r=Je[t].against(e).get(t);return r.length?r[0].scoreFor(t):0}(r)})),t}))}}const nt={RULES:{"cc-name":/(accountholdername|titulaire)|(cc-?name|card-?name|cardholder-?name|cardholder|(^nom$))|(card.?(?:holder|owner)|name.*(\b)?on(\b)?.*card|(?:card|cc).?name|cc.?full.?name|karteninhaber|nombre.*tarjeta|nom.*carte|nome.*cart|名前|имя.*карты|信用卡开户名|开户名|持卡人姓名|持卡人姓名)/u,"cc-number":/(cc|kk)nr|(cc-?number|cc-?num|card-?number|card-?num|number|cc|cc-?no|card-?no|credit-?card|numero-?carte|carte|carte-?credit|num-?carte|cb-?num)|((add)?(card|cc|acct)[\s#]*)(number|no|num|field)|((telefon|haus|person|fødsels)?nummer[^\s]*|nummer[^\s]*|カード番号|номер.*карты|信用卡号(?:码|卡號)?|카드|(numero|número|numéro))(?:(?:document|fono|phone|réservation)\b|$)/u,"cc-exp-month":/(month|(cc|kk)month)|((^exp-?month$)|(^cc-?exp-?month$)|(^cc-?month$)|(^card-?month$)|(^cc-?mo$)|(^card-?mo$)|(^exp-?mo$)|(^card-?exp-?mo$)|(^cc-?exp-?mo$)|(^card-?expiration-?month$)|(^expiration-?month$)|(^cc-?mm$)|(^cc-?m$)|(^card-?mm$)|(^card-?m$)|(^card-?exp-?mm$)|(^cc-?exp-?mm$)|(^exp-?mm$)|(^exp-?m$)|(^expire-?month$)|(^expire-?mo$)|(^expiry-?month$)|(^expiry-?mo$)|(^card-?expire-?month$)|(^card-?expire-?mo$)|(^card-?expiry-?month$)|(^card-?expiry-?mo$)|(^mois-?validite$)|(^mois-?expiration$)|(^m-?validite$)|(^m-?expiration$)|(^expiry-?date-?field-?month$)|(^expiration-?date-?month$)|(^expiration-?date-?mm$)|(^exp-?mon$)|(^validity-?mo$)|(^exp-?date-?mo$)|(^cb-?date-?mois$)|(^date-?m$))|(expir|exp.*mo|exp.*date|ccmonth|cardmonth|addmonth|gueltig|gültig|monat|fecha|date.*exp|scadenza|有効期限|validade|срок действия карты|月)/u,"cc-exp-year":/(year|(cc|kk)year)|((^exp-?year$)|(^cc-?exp-?year$)|(^cc-?year$)|(^card-?year$)|(^cc-?yr$)|(^card-?yr$)|(^exp-?yr$)|(^card-?exp-?yr$)|(^cc-?exp-?yr$)|(^card-?expiration-?year$)|(^expiration-?year$)|(^cc-?yy$)|(^cc-?y$)|(^card-?yy$)|(^card-?y$)|(^card-?exp-?yy$)|(^cc-?exp-?yy$)|(^exp-?yy$)|(^exp-?y$)|(^cc-?yyyy$)|(^card-?yyyy$)|(^card-?exp-?yyyy$)|(^cc-?exp-?yyyy$)|(^expire-?year$)|(^expire-?yr$)|(^expiry-?year$)|(^expiry-?yr$)|(^card-?expire-?year$)|(^card-?expire-?yr$)|(^card-?expiry-?year$)|(^card-?expiry-?yr$)|(^an-?validite$)|(^an-?expiration$)|(^annee-?validite$)|(^annee-?expiration$)|(^expiry-?date-?field-?year$)|(^expiration-?date-?year$)|(^cb-?date-?ann$)|(^expiration-?date-?yy$)|(^expiration-?date-?yyyy$)|(^validity-?year$)|(^exp-?date-?year$)|(^date-?y$))|(exp|^\/|(add)?year|ablaufdatum|gueltig|gültig|jahr|fecha|scadenza|有効期限|validade|срок действия карты|年|有效期)/u,"cc-exp":/((^cc-?exp$)|(^card-?exp$)|(^cc-?expiration$)|(^card-?expiration$)|(^cc-?ex$)|(^card-?ex$)|(^card-?expire$)|(^card-?expiry$)|(^validite$)|(^expiration$)|(^expiry$)|mm-?yy|mm-?yyyy|yy-?mm|yyyy-?mm|expiration-?date|payment-?card-?expiration|(^payment-?cc-?date$))|(expir|exp.*date|^expfield$|gueltig|gültig|fecha|date.*exp|scadenza|有効期限|validade|срок действия карты)/u,"cc-type":/(type|kartenmarke)|((^cc-?type$)|(^card-?type$)|(^card-?brand$)|(^cc-?brand$)|(^cb-?type$))/u},CREDIT_CARD_FIELDNAMES:["cc-name","cc-number","cc-exp-month","cc-exp-year","cc-exp","cc-type"],ADDRESS_FIELDNAMES:[],_matchContiguousSubArray:(e,t)=>e.some(((r,n)=>t.every(((t,r)=>t==e[n+r])))),_isExpirationMonthLikely(e){if(!HTMLSelectElement.isInstance(e))return!1;const t=[...e.options],r=Array(12).fill(1).map(((e,t)=>e+t));return!(t.length<12||t.length>13)&&(this._matchContiguousSubArray(t.map((e=>+e.value)),r)||this._matchContiguousSubArray(t.map((e=>+e.label)),r))},_isExpirationYearLikely(e){if(!HTMLSelectElement.isInstance(e))return!1;const t=[...e.options],r=(new Date).getFullYear(),n=Array(3).fill(0).map(((e,t)=>e+r+t));return this._matchContiguousSubArray(t.map((e=>+e.value)),n)||this._matchContiguousSubArray(t.map((e=>+e.label)),n)},_parsePhoneFields(t){let r;const n=this.PHONE_FIELD_GRAMMARS;for(let e=0;e<n.length;e++){let a=t.parsingIndex,i=e;for(;e<n.length&&n[e][0]&&t.elementExisting(a);e++,a++){let r=t.getFieldDetailByIndex(a);if(!r||n[e][0]!=r.fieldName||r._reason&&"autocomplete"==r._reason)break;let i=r.elementWeakRef.get();if(!i)break;if(n[e][2]&&(!i.maxLength||n[e][2]<i.maxLength))break}if(e>=n.length)break;if(!n[e][0]){r={ruleFrom:i,ruleTo:e};break}for(;e<n.length&&n[e][0];e++);}let a=!1;if(r){let{ruleFrom:e,ruleTo:i}=r,s=t.parsingIndex;for(let r=e;r<i;r++)t.updateFieldName(s,n[r][1]),t.parsingIndex++,s++,a=!0}if(t.parsingFinished)return a;let i=t.getFieldDetailByIndex(t.parsingIndex);if(i&&"autocomplete"!=i._reason&&t.parsingIndex>0){const r=new RegExp("\\bext|ext\\b|extension|ramal","iu"),n=t.getFieldDetailByIndex(t.parsingIndex-1),s=e.getCategoryFromFieldName(n.fieldName);n&&"tel"==s&&this._matchRegexp(i.elementWeakRef.get(),r)&&(t.updateFieldName(t.parsingIndex,"tel-extension"),t.parsingIndex++,a=!0)}return a},_parseAddressFields(e){let t=!1;const r=["address-line1","address-line2","address-line3"],n={"address-line1":new RegExp("address[_-]?line(1|one)|address1|addr1|addrline1|address_1|indirizzo1|住所1|地址1|주소.?1","iu"),"address-line2":new RegExp("address[_-]?line(2|two)|address2|addr2|addrline2|address_2|indirizzo2|住所2|地址2|주소.?2","iu"),"address-line3":new RegExp("address[_-]?line(3|three)|address3|addr3|addrline3|address_3|indirizzo3|住所3|地址3|주소.?3","iu")};for(;!e.parsingFinished;){let a=e.getFieldDetailByIndex(e.parsingIndex);if(!a||!r.includes(a.fieldName)||"autocomplete"==a._reason)break;const i=a.elementWeakRef.get();for(let r of Object.keys(n))this._matchRegexp(i,n[r])&&(e.updateFieldName(e.parsingIndex,r),t=!0);e.parsingIndex++}return t},_parseCreditCardFields(t){if(t.parsingFinished)return!1;const r=t.parsingIndex,n=t.getFieldDetailByIndex(t.parsingIndex);if(!n||n._reason&&"autocomplete"==n._reason)return!1;if(!["cc-exp","cc-type","cc-exp-month","cc-exp-year"].includes(n.fieldName))return!1;if(e.isFathomCreditCardsEnabled()&&Je.types.includes(n.fieldName))return t.parsingIndex++,!0;const a=n.elementWeakRef.get();if(HTMLSelectElement.isInstance(a))for(let e of a.querySelectorAll("option"))if(i.getNetworkFromName(e.value)||i.getNetworkFromName(e.text))return t.updateFieldName(t.parsingIndex,"cc-type"),t.parsingIndex++,!0;if("month"==a.type)return t.updateFieldName(t.parsingIndex,"cc-exp"),t.parsingIndex++,!0;if("cc-exp-month"==t.getFieldDetailByIndex(t.parsingIndex++).fieldName&&!t.parsingFinished&&"cc-exp-year"==t.getFieldDetailByIndex(t.parsingIndex++).fieldName)return!0;if(t.parsingIndex=r,this._isExpirationMonthLikely(a)&&(t.updateFieldName(t.parsingIndex,"cc-exp-month"),t.parsingIndex++,!t.parsingFinished)){const e=t.getFieldDetailByIndex(t.parsingIndex).elementWeakRef.get();if(this._isExpirationYearLikely(e))return t.updateFieldName(t.parsingIndex,"cc-exp-year"),t.parsingIndex++,!0}if(t.parsingIndex=r,this._findMatchedFieldName(a,["cc-exp-month"])&&(t.updateFieldName(t.parsingIndex,"cc-exp-month"),t.parsingIndex++,!t.parsingFinished)){const e=t.getFieldDetailByIndex(t.parsingIndex).elementWeakRef.get();if(this._findMatchedFieldName(e,["cc-exp-year"]))return t.updateFieldName(t.parsingIndex,"cc-exp-year"),t.parsingIndex++,!0}if(t.parsingIndex=r,this._matchRegexp(a,/^mm$/gi)&&(t.updateFieldName(t.parsingIndex,"cc-exp-month"),t.parsingIndex++,!t.parsingFinished)){const e=t.getFieldDetailByIndex(t.parsingIndex).elementWeakRef.get();if(this._matchRegexp(e,/^(yy|yyyy)$/))return t.updateFieldName(t.parsingIndex,"cc-exp-year"),t.parsingIndex++,!0}return t.parsingIndex=r,this._matchRegexp(a,/(?:exp.*date[^y\\n\\r]*|mm\\s*[-/]?\\s*)yy(?:[^y]|$)/gi)||this._matchRegexp(a,/(?:exp.*date[^y\\n\\r]*|mm\\s*[-/]?\\s*)yyyy(?:[^y]|$)/gi)?(t.updateFieldName(t.parsingIndex,"cc-exp"),t.parsingIndex++,!0):(t.parsingIndex=r,this._findMatchedFieldName(a,["cc-exp"])?(t.updateFieldName(t.parsingIndex,"cc-exp"),t.parsingIndex++,!0):(t.parsingIndex=r,t.updateFieldName(t.parsingIndex,null),t.parsingIndex++,!0))},getFormInfo(t,r=!1){const n=Array.from(t.elements).filter((t=>e.isCreditCardOrAddressFieldType(t)));if(n.length<=0)return[];let a=new rt(n,{allowDuplicates:r,sectionEnabled:this._sectionEnabled});for(;!a.parsingFinished;){let e=this._parsePhoneFields(a),t=this._parseAddressFields(a),r=this._parseCreditCardFields(a);e||t||r||a.parsingIndex++}return s.clearLabelMap(),a.getSectionFieldDetails()},_getPossibleFieldNames(e){let t=[];if("off"==e.autocomplete||e.form?.autocomplete,t.push(...this.CREDIT_CARD_FIELDNAMES),HTMLSelectElement.isInstance(e)){const e=["address-level1","address-level2","country","cc-exp-month","cc-exp-year","cc-exp","cc-type"];t=t.filter((t=>e.includes(t)))}return t},getInfo(t,r){function n(e,t=null){return{fieldName:e,section:"",addressType:"",contactType:"",confidence:t}}let a=t.getAutocompleteInfo();if(a&&a.fieldName&&"on"!=a.fieldName&&"off"!=a.fieldName)return a._reason="autocomplete",a;let i=this._getPossibleFieldNames(t);if("email"==t.type&&i.includes("email"))return n("email");if(e.isFathomCreditCardsEnabled()){let e=i.filter((e=>Je.types.includes(e))),[a,s]=r.getFathomField(t,e);if(a)return n(a,s)}if(i.length){let e=this._findMatchedFieldName(t,i);if(e)return n(e)}return null},_getElementStrings:e=>({*[Symbol.iterator](){yield e.id,yield e.name,yield e.placeholder?.trim();const t=s.findLabelElements(e);for(let e of t)yield*s.extractLabelStrings(e)}}),_findMatchedFieldName(e,t){const r=this._getElementStrings(e);for(let e of t)for(let t of r)if(this.RULES[e].test(t?.toLowerCase()))return e;return null},_matchRegexp(e,t){const r=this._getElementStrings(e);for(const e of r)if(t.test(e))return!0;return!1},PHONE_FIELD_GRAMMARS:[["tel","tel-country-code",3],["tel","tel-area-code",3],["tel","tel-local-prefix",3],["tel","tel-local-suffix",4],[null,null,0],["tel","tel-area-code",0],["tel","tel-local-prefix",3],["tel","tel-local-suffix",4],[null,null,0]]};class at{constructor(){this.creditCardSections=[]}findForms(e){for(var t=0;t<e.length;t++){var r=e[t];"FORM"===r.nodeName?this.findCreditCardForms(r):r.hasChildNodes()&&this.findForms(r.childNodes)}return!1}findCreditCardForms(t){const r=nt.getFormInfo(t).filter((t=>t.type==e.SECTION_TYPES.CREDIT_CARD)).map((e=>e.fieldDetails)),n=r.flatMap((e=>e.map(this.getFieldRef)));return this.creditCardSections.push({form:t,fields:r[0]}),n}getFieldRef(e){return e.elementWeakRef.get()}getSectionId(e){return this.creditCardSections.findIndex((t=>t.form===e))}getSection(e){const t=this.getSectionId(e);return{id:t,formInfo:this.creditCardSections[t]}}fillCCFormFields(e,t){for(let r of e.fields){const e=this.getFieldRef(r);r.fieldName in t&&(e.value=t[r.fieldName])}}fillCreditCardInfo(e){const{id:t,data:r}=JSON.parse(e);this.fillCCFormFields(this.creditCardSections?.[t],r)}}const it=e=>t=>window.webkit.messageHandlers.creditCardMessageHandler?.postMessage({type:e,payload:t}),st=it("capture-credit-card-form"),ot=it("fill-credit-card-form");Object.defineProperty(window.__firefox__,"CreditCardHelper",{enumerable:!1,configurable:!1,writable:!1,value:Object.freeze(new class{constructor(){this.creditCardAutofill=new at,this.onLoad=this.onLoad.bind(this),this.onFocus=this.onFocus.bind(this),this.onSumbit=this.onSumbit.bind(this),window.addEventListener("load",this.onLoad),window.addEventListener("submit",this.onSumbit)}attachFieldListeners(){[...document.forms].forEach((e=>{const{formInfo:t}=this.creditCardAutofill.getSection(e);t||(this.creditCardAutofill.findCreditCardForms(e).forEach((e=>e.onfocus=this.onFocus)),e.submit=e=>this.onSumbit(e,"submit"))}))}onLoad(){new MutationObserver((e=>{for(var t=0;t<e.length;++t)this.attachFieldListeners()})).observe(document.body,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),this.attachFieldListeners()}fieldsToPayload(e){return e.map((e=>({type:e.fieldName,value:e.elementWeakRef.get().value})))}onFocus(e){const{id:t,formInfo:r}=this.creditCardAutofill.getSection(e.target.form);r&&ot({id:t,fieldTypes:this.fieldsToPayload(r.fields)})}onSumbit(e){e.preventDefault();const t="FORM"===e.target.tagName?e.target:e.target.form,{id:r,formInfo:n}=this.creditCardAutofill.getSection(t);n&&st({id:r,fieldTypes:this.fieldsToPayload(n.fields)})}fillCreditCardInfo(e){this.creditCardAutofill.fillCreditCardInfo(e)}})})})()})();